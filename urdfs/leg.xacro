<?xml version="1.0"?>


<robot xmlns:xacro="http://ros.org/wiki/xacro" name="solo">

    <!-- Things that are needed only for Gazebo (not the physical robot). These include sensor and controller plugin specifications -->
    <xacro:include filename="$(find starbot_description)/urdfs/leg.transmission.xacro"/>
    <xacro:include filename="$(find starbot_description)/urdfs/leg.gazebo.xacro"/>
    
    <!-- These are absoulte distance value, the sign are decided below -->
    
    <xacro:property name="MAX_TORQUE" value="0" />
    <xacro:property name="VELOCITY" value="0" />
    <xacro:property name="UPPER_LEG" value="0.15312" />
    <xacro:property name="LOWER_LEG_x" value="0.22546" />
    <xacro:property name="LOWER_LEG_y" value="0.00035" />
    <xacro:property name="LOWER_LEG_z" value="2e-05" />
    <xacro:property name="PRE_WHEEL" value="0.10183" />


    <!-- This macro has for purpose to define a leg -->
    <xacro:macro name="leg" params="name parent is_front is_right robot_name *origin">
           
          <!-- Starbot 1.0 -->

	  <!--BS_JOINT: Joint between the body and the shoulder -->
            <joint name="${name}_bs_joint" type="revolute">
                <parent link="${parent}"/>
                <child link="${name}_shoulder"/>
                <xacro:insert_block name="origin"/>
                
                <!-- joints rotates around the z-axis -->
                <axis xyz="0 0 1"/>
                
                <!-- limit of the joint -->
                <limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
            </joint>
	  
	  <!-- SHOULDER ASSEMBLY -->	
            <link name="${name}_shoulder">
            	<!-- create a dummy shoulder_assembly link to join the two joints -->
            	<!--VISUAL-->	
	        <visual>
                    <xacro:if value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LF SHOULDER -->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/shoulder_y.stl"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RF SHOULDER-->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/shoulder_x.stl"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:if>
                    <xacro:unless value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LH SHOULDER -->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/shoulder_nx.stl"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RH SHOULDER -->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/shoulder_ny.stl"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:unless>
	                <material name="shoulder_color">
                    		<color rgba="0.8 0.8 0.8 1.0"/>
                	</material>
	            </visual>
	            
	            <!--COLLISION-->	
	            <collision>
	            <origin xyz="0 0 0" rpy="0 0 0" />
                    <xacro:if value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LF_BS -->
                        	<geometry>
                        	    <box size="0.0707 0.00651 0.07002"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RF_BS -->
                        	<geometry>
                        	    <box size="0.00651 0.0707 0.07002"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:if>
                    <xacro:unless value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LH_BS -->
                        	<geometry>
                        	    <box size="0.00651 0.0707 0.07002"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RH_BS -->
                        	<geometry>
                        	    <box size="0.0707 0.00651 0.07002"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:unless>
	                <material name="collision_color">
      				<color rgba="0.8 0.8 0.8 1.0"/>
    			</material>
	            </collision>
	    
	            <!--INERTIAL -->
	            <inertial>
	            	<origin xyz="0 0 0" rpy="0 0 0" />
	                <mass value="0.0001"/>
	                <inertia ixx="0" ixy="0" ixz="0" iyy="0" iyz="0" izz="0"/>          
	            </inertial>
	        </link> 
	        
	        
	     <!--UPPER LEG JOINT-->  
	     
            <joint name="${name}_upper_leg_joint" type="revolute">
                <parent link="${name}_shoulder"/>
                <child link="${name}_upperleg"/>
                <xacro:insert_block name="origin"/>
                
                <!-- joints rotates around the y-axis -->
                
                <!-- limit and placement of the joint -->
                <xacro:if value="${is_front}">
                    <xacro:unless value="${is_right}">
                        <!-- LF_UPPER_LEG_JOINT -->
                        <axis xyz="1 0 0"/>
                        <limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="0 ${UPPER_LEG}  0" rpy="0 0 0" />
                    </xacro:unless>
                    <xacro:if value="${is_right}">
                        <!-- RF_UPPER_LEG_JOINT -->
                        <axis xyz="0 1 0"/>
			<limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="${UPPER_LEG} 0 0" rpy="0 0 0" />
                    </xacro:if>
                </xacro:if>
                <xacro:unless value="${is_front}">
                    <xacro:unless value="${is_right}">
                        <!-- LH_UPPER_LEG_JOINT -->
                        <axis xyz="0 -1 0"/>
			<limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="-${UPPER_LEG} 0 0" rpy="0 0 0" />
                    </xacro:unless>
                    <xacro:if value="${is_right}">
                        <!-- RH_UPPER_LEG_JOINT -->
                        <axis xyz="-1 0 0"/>
			<limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="0 -${UPPER_LEG} 0" rpy="0 0 0" />
                    </xacro:if>
                </xacro:unless>
                
                <!-- pybullet simulation parameters -->
                <dynamics damping="0.0" friction="0.0"/>
            </joint>
	  
	  <!-- UPPER LEG ASSEMBLY -->	
            <link name="${name}_upperleg">
            	<!--VISUAL-->	
	        <visual>
	            <origin xyz="0 0 0" rpy="0 0 0" />
                    <xacro:if value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LF UPPER_LEG -->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_y.stl"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RF UPPER_LEG-->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_x.stl"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:if>
                    <xacro:unless value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LH UPPER_LEG -->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_nx.stl"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RH UPPER_LEG -->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_ny.stl"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:unless>
	                <material name="upper_leg_color">
                    		<color rgba="0.8 0.8 0.8 1.0"/>
                	</material>
	            </visual>
	            
	            <!--COLLISION-->	
	            <collision>
	            <origin xyz="0 0 0" rpy="0 0 0" />
                    <xacro:if value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LF UPPER_LEG -->
                        	<geometry>
                        	    <box size="0.07002 0.30016 0.0707"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RF UPPER_LEG -->
                        	<geometry>
                        	    <box size="0.30016 0.07002 0.0707"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:if>
                    <xacro:unless value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LH UPPER_LEG -->
                        	<geometry>
                        	    <box size="0.30016 0.07002 0.0707"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RH UPPER_LEG-->
                        	<geometry>
                        	    <box size="0.07002 0.30016 0.0707"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:unless>
	                <material name="collision_color">
      				<color rgba="0.8 0.8 0.8 1.0"/>
    			</material>
	            </collision>
	    
	            <!-- UPPER LEG LINK INERTIAL -->
            	<xacro:unless value="${is_right}">
                <!-- Left upper leg inertia -->
                <inertial>
                     <origin xyz="0 0 0" rpy="0 0 0"/>
                    <mass value="2.3"/>
                     <inertia ixx="0.01259" ixy="0" ixz="0" iyy="0.00147" iyz="0" izz="0.01259"/>
                </inertial>
            	</xacro:unless>
            	<xacro:if value="${is_right}">
            	<!-- Right upper leg inertia -->
                <inertial>
                     <origin xyz="0 0 0" rpy="0 0 0"/>
                    <mass value="2.3"/>
                    <inertia ixx="0.00147" ixy="0" ixz="0" iyy="0.01259" iyz="0" izz="0.01259"/>
                </inertial>
            	</xacro:if>
            
	        </link>  
	        
	        
	     <!--LOWER LEG JOINT-->  
	     
            <joint name="${name}_lower_leg_joint" type="prismatic">
                <parent link="${name}_upperleg"/>
                <child link="${name}_lowerleg"/>
                <xacro:insert_block name="origin"/>
                
                <!-- joints rotates around the x-axis (refer to the x-axis align leg) -->
                
                
                <!-- limit and placement of the joint -->
                <xacro:if value="${is_front}">
                    <xacro:unless value="${is_right}">
                        <!-- LF_LOWER_LEG_JOINT -->
                        <axis xyz="0 1 0"/>
                        <limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="${LOWER_LEG_y} ${LOWER_LEG_x} -${LOWER_LEG_z}" rpy="0 0 0" />
                    </xacro:unless>
                    <xacro:if value="${is_right}">
                    	<axis xyz="1 0 0"/>
                        <!-- RF_LOWER_LEG_JOINT -->
			<limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="${LOWER_LEG_x} -${LOWER_LEG_y} -${LOWER_LEG_z}" rpy="0 0 0" />
                    </xacro:if>
                </xacro:if>
                <xacro:unless value="${is_front}">
                    <xacro:unless value="${is_right}">
                    	<axis xyz="-1 0 0"/>
                        <!-- LH_LOWER_LEG_JOINT -->
			<limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="$-{LOWER_LEG_x} -${LOWER_LEG_y} -${LOWER_LEG_z}" rpy="0 0 0" />
                    </xacro:unless>
                    <xacro:if value="${is_right}">
                        <!-- RF_LOWER_LEG_JOINT -->
                        <axis xyz="0 -1 0"/>
			<limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="${LOWER_LEG_y} -${LOWER_LEG_x} -${LOWER_LEG_z}" rpy="0 0 0" />
                    </xacro:if>
                </xacro:unless>
                
                <!-- pybullet simulation parameters -->
                <dynamics damping="0.0" friction="0.0"/>
            </joint>
	  
	  <!-- LOWER LEG ASSEMBLY -->	
            <link name="${name}_lowerleg">
            	<!--VISUAL-->	
	        <visual>
	            <origin xyz="0 0 0" rpy="0 0 0" />
                    <xacro:if value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LF LOWER_LEG -->
                            <!--we need mesh geometry otherwise strange behaviour happens-->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_y.stl"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RF LOWER_LEG-->
                        	<geometry>
                        	    <cylinder radius="0.02029" length="0.4002"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:if>
                    <xacro:unless value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LH LOWER_LEG -->
                        	<geometry>
                        	    <cylinder radius="0.02029" length="0.4002"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RH LOWER_LEG -->
                        	<geometry>
                        	    <cylinder radius="0.02029" length="0.4002"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:unless>
	                <material name="upper_leg_color">
                    		<color rgba="0.3 0.3 0.6 1.0"/>
                	</material>
	            </visual>
	            
	            <!--COLLISION-->	
	            <collision>
	            <origin xyz="0 0 0" rpy="0 0 0" />
                    <xacro:if value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LF LOWER_LEG -->
                        	<geometry>
                        	    <box size="0.04058 0.25009 0.04002"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RF LOWER_LEG -->
                        	<geometry>
                        	    <box size="0.25009 0.04058 0.04002"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:if>
                    <xacro:unless value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LH LOWER_LEG -->
                        	<geometry>
                        	     <box size="0.25009 0.04058 0.04002"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RH LOWER_LEG-->
                        	<geometry>
                        	    <box size="0.04058 0.25009 0.04002"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:unless>
	                <material name="collision_color">
      				<color rgba="0.8 0.8 0.8 1.0"/>
    			</material>
	            </collision>
	    
	            <!-- LOWER LEG LINK INERTIAL -->
            	<xacro:unless value="${is_right}">
                <!-- Left lower leg inertia -->
                <inertial>
                    <origin xyz="0 0 0" rpy="0 0 0"/>
        	    <mass value="2.36"/>
        	    <inertia ixx="0.00056" ixy="0" ixz="0" iyy="0.00056" iyz="0" izz="0.00049"/>
                </inertial>
            	</xacro:unless>
            	<xacro:if value="${is_right}">
            	<!-- Right lower leg inertia -->
                <inertial>
                     <origin xyz="0 0 0" rpy="0 0 0"/>
        	     <mass value="2.36"/>
        	     <inertia ixx="0.00954" ixy="0" ixz="0" iyy="0.00954" iyz="0" izz="0.01845"/>
                </inertial>
            	</xacro:if>
            
	        </link>

        <!--PRE WHEEL JOINT-->

            <joint name="${name}_pre_wheel_joint" type="revolute">
                <parent link="${name}_lowerleg"/>
                <child link="${name}_pre_wheel"/>
                <xacro:insert_block name="origin"/>

                <!-- joints rotates around the x-axis (refer to the x-axis align leg) -->


                <!-- limit and placement of the joint -->
                <xacro:if value="${is_front}">
                    <xacro:unless value="${is_right}">
                        <!-- LF_PRE_WHEEL_JOINT -->
                        <axis xyz="1 0 0"/>
                        <limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="0 ${PRE_WHEEL} 0" rpy="0 0 0" />
                    </xacro:unless>
                    <xacro:if value="${is_right}">
                    	<axis xyz="0 1 0"/>
                        <!-- RF_PRE_WHEEL_JOINT -->
			<limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="${PRE_WHEEL} 0 0" rpy="0 0 0" />
                    </xacro:if>
                </xacro:if>
                <xacro:unless value="${is_front}">
                    <xacro:unless value="${is_right}">
                    	<axis xyz="0 -1 0"/>
                        <!-- LH_PRE_WHEEL_JOINT -->
			<limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="$-{PRE_WHEEL} 0 0" rpy="0 0 0" />
                    </xacro:unless>
                    <xacro:if value="${is_right}">
                        <!-- RF_PRE_WHEEL_JOINT -->
                        <axis xyz="-1 0 0"/>
			<limit effort="${MAX_TORQUE}" lower="-3.14" upper="3.14" velocity="${VELOCITY}"/>
                        <origin xyz="0 -${PRE_WHEEL} 0" rpy="0 0 0" />
                    </xacro:if>
                </xacro:unless>

                <!-- pybullet simulation parameters -->
                <dynamics damping="0.0" friction="0.0"/>
            </joint>

	  <!-- PRE WHEEL ASSEMBLY -->
            <link name="${name}_pre_wheel">
            	<!--VISUAL-->
	        <visual>
	            <origin xyz="0 0 0" rpy="0 0 0" />
                    <xacro:if value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LF PRE_WHEEL -->
                            <!--we need mesh geometry otherwise strange behaviour happens-->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_y.stl" scale = "0.5 0.5 0.5"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RF PRE_WHEEL-->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_x.stl" scale = "0.5 0.5 0.5"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:if>
                    <xacro:unless value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LH PRE_WHEEL -->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_nx.stl" scale = "0.5 0.5 0.5"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RH PRE_WHEEL -->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_ny.stl" scale = "0.5 0.5 0.5"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:unless>
	                <material name="upper_leg_color">
                    		<color rgba="0.3 0.3 0.6 1.0"/>
                	</material>
	            </visual>

            <!--COLLISION-->
	            <collision>
	            <origin xyz="0 0 0" rpy="0 0 0" />
                    <xacro:if value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LF PRE_WHEEL -->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_ny.stl" scale = "0.5 0.5 0.5"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RF PRE_WHEEL -->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_ny.stl" scale = "0.5 0.5 0.5"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:if>
                    <xacro:unless value="${is_front}">
                        <xacro:unless value="${is_right}">
                            <!-- LH PRE_WHEEL -->
                        	<geometry>
                        	     <mesh filename="package://starbot_description/meshes/stl/upper_leg_ny.stl" scale = "0.5 0.5 0.5"/>
                        	</geometry>
                        </xacro:unless>
                        <xacro:if value="${is_right}">
                            <!-- RH PRE_WHEEL-->
                        	<geometry>
                        	    <mesh filename="package://starbot_description/meshes/stl/upper_leg_ny.stl" scale = "0.5 0.5 0.5"/>
                        	</geometry>
                        </xacro:if>
                    </xacro:unless>
	                <material name="collision_color">
      				<color rgba="0.8 0.8 0.8 1.0"/>
    			</material>
	            </collision>

	            <!-- PRE WHEEL LINK INERTIAL -->
            	<xacro:unless value="${is_right}">
                <!-- Left pre_wheel inertia -->
                <inertial>
                    <origin xyz="0 0 0" rpy="0 0 0"/>
                    <mass value="0.66"/>
                    <inertia ixx="0.00015" ixy="0" ixz="0" iyy="0.00015" iyz="0" izz="0.00013"/>
                </inertial>
            	</xacro:unless>
            	<xacro:if value="${is_right}">
            	<!-- Right pre_wheel inertia -->
                <inertial>
                     <origin xyz="0 0 0" rpy="0 0 0"/>
                    <mass value="0.66"/>
                    <inertia ixx="0.00029" ixy="0" ixz="0" iyy="0.00029" iyz="0" izz="0.00041"/>
                </inertial>
            	</xacro:if>

	        </link>
	        
	
        <!-- Extensions -->
        <xacro:leg_transmission name="${name}"/>
        <xacro:leg_gazebo name="${name}" robot_name="${robot_name}"/>
    </xacro:macro>
</robot>
